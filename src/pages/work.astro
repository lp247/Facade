---
import {getCollection} from "astro:content";
import Standard from "@layouts/Standard.astro";
import TechBadgeList from "@components/TechBadgeList.astro";

const entries = await getCollection("job");
const entriesWithContent = await Promise.all(
    entries.map(async (entry) => {
        const Content = await entry.render();
        return {
            ...entry,
            rendered: Content,
        };
    }),
);
entriesWithContent.sort((a, b) => (a.data.startDate > b.data.startDate ? -1 : 1));
---

<Standard heading="Work Experience">
    {
        entriesWithContent.map((entry) => {
            const Content = entry.rendered.Content;
            const startString = new Date(entry.data.startDate).toISOString().substring(0, 10);
            const endString = !!entry.data.endDate ? new Date(entry.data.endDate).toISOString().substring(0, 10) : "Today";
            const location = entry.data.location;
            return (
                <div id={entry.slug}>
                    <h2 class="mb-2 mt-12">
                        {entry.data.jobDescription} @ {entry.data.company}
                    </h2>
                    <hr />
                    <p class="my-2 font-bold text-sm font-sans">
                        From {startString} until {endString} in {location}
                    </p>
                    <TechBadgeList class="mb-2" techs={entry.data.techs.map((t) => t.id)} />
                    <hr />
                    <Content />
                </div>
            );
        })
    }
</Standard>
